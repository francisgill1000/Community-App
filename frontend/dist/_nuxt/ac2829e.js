(window.webpackJsonp=window.webpackJsonp||[]).push([[12,182,253],{1268:function(e,t,n){"use strict";n.r(t);var r=n(133),o=n(87),c=n(516),l=n(876),h=n(350),f=n(147),d=n(515),m=n(873),v=n(349),_=n(214),D=n(23),S=n(3),T=(n(88),n(55),n(6),n(11),n(354),n(35),n(13),n(215),n(99),n(216),n(37),n(80),{props:["item"],data:function(){var e;return e={dialog:!1,timezones:[],timezone_id:"",floor_id:[],floors:[],room_id:[],rooms:[],isCompany:!0,loading:!1,counter:0,devices_dialog:[],displaybutton:!1,progressloading:!1,searchInput:"",snackbar:{message:"",color:"black",show:!1},errors:[],response:"",color:"primary"},Object(S.a)(e,"loading",!0),Object(S.a)(e,"endpointDevise","device"),Object(S.a)(e,"leftSelectedEmp",[]),Object(S.a)(e,"departmentselected",[]),Object(S.a)(e,"departments",[]),Object(S.a)(e,"leftTenants",[]),Object(S.a)(e,"rightSelectedEmp",[]),Object(S.a)(e,"rightTenants",[]),Object(S.a)(e,"leftSelectedDevices",[]),Object(S.a)(e,"leftDevices",[]),Object(S.a)(e,"rightSelectedDevices",[]),Object(S.a)(e,"rightDevices",[]),Object(S.a)(e,"department_ids",["---"]),Object(S.a)(e,"timezones",["Timeszones are not available"]),Object(S.a)(e,"timezonesselected",[]),Object(S.a)(e,"options",{params:{company_id:this.$auth.user.company_id,cols:["id","name"]}}),e},mounted:function(){var e=this;this.$nextTick((function(){var e=this;setTimeout((function(){e.loading=!1}),2e3)})),setTimeout((function(){e.loading=!1}),2e3)},created:function(){var e=this;return Object(D.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.progressloading=!0,n=e.item,e.floor_id=n.floor_id,e.room_id=n.room_id,e.timezone_id=n.timezone_id,t.next=7,e.getTimezonesFromApi();case 7:return e.getDevisesDataFromApi(),t.next=10,e.getTanentsAndMembersByRoom(n.room_id);case 10:case"end":return t.stop()}}),t)})))()},methods:{deleteMapping:function(e){var t=this;confirm("Are you sure you wish to delete , to mitigate any inconvenience in future.")&&this.$axios.delete("tanent-timezone-mapping/".concat(e)).then((function(){t.$emit("success","Record deleted successfully")})).catch((function(e){return console.log(e)}))},goback:function(){this.$router.push("/community/access_control/2")},getTimezonesFromApi:function(){var e=this;return Object(D.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n={params:{company_id:e.$auth.user.company_id}},e.$axios.get("timezone-list",n).then((function(t){var data=t.data;return e.timezones=data})).catch((function(e){return console.log(e)}));case 2:case"end":return t.stop()}}),t)})))()},getTanentsAndMembersByRoom:function(e){var t=this;return Object(D.a)(regeneratorRuntime.mark((function n(){var r,data,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$axios.get("tanents-and-members-by-room-id",{params:{company_id:t.$auth.user.company_id,room_id:e,floor_id:t.floor_id}});case 2:r=n.sent,data=r.data,o=[],data.forEach((function(e){var t;o.push({id:e.id,full_name:e.full_name+" (".concat((null==e||null===(t=e.room)||void 0===t?void 0:t.room_number)||"",")"),system_user_id:parseInt(e.system_user_id),profile_picture:e.profile_picture,rfid:e.rfid}),e.members_only.forEach((function(t){var n;o.push({id:e.id+t.id,full_name:t.full_name+" (".concat((null==e||null===(n=e.room)||void 0===n?void 0:n.room_number)||"",")"),system_user_id:t.system_user_id,profile_picture:t.profile_picture,rfid:t.rfid})})),e.maids.forEach((function(t){var n;o.push({id:e.id+t.id,full_name:t.full_name+" (".concat((null==e||null===(n=e.room)||void 0===n?void 0:n.room_number)||"",")"),system_user_id:t.system_user_id,profile_picture:t.profile_picture,rfid:t.rfid})}))})),t.leftTenants=o,t.getDevisesDataFromApi();case 8:case"end":return n.stop()}}),n)})))()},can:function(e){return this.$pagePermission.can(e,this)},resetErrorMessages:function(){this.errors=[],this.response="",this.leftTenants.forEach((function(element){element.sdkEmpResponse=""})),this.leftDevices.forEach((function(element){element.sdkDeviceResponse=""}))},getDevisesDataFromApi:function(){var e=this;this.$axios.get(this.endpointDevise,{params:{per_page:1e3,company_id:this.$auth.user.company_id,sortBy:"status_id"}}).then((function(t){var data=t.data;e.leftDevices=data.data}))},sortObject:function(e){return e.sort((function(a,b){if(a.full_name&&b.full_name){var e=a.full_name.toUpperCase(),t=b.full_name.toUpperCase();return e<t?-1:e>t?1:0}}))},sortObjectD:function(e){return e.sort((function(a,b){if(a.device_id&&b.device_id){var e=a.device_id.toUpperCase(),t=b.device_id.toUpperCase();return e<t?-1:e>t?1:0}return 0}))},verifySubmitButton:function(){this.rightDevices.length>0?this.displaybutton=!0:this.displaybutton=!1},allmoveToLeftemp:function(){this.resetErrorMessages(),this.leftTenants=this.leftTenants.concat(this.rightTenants),this.rightTenants=[],this.leftTenants=this.sortObject(this.leftTenants),this.verifySubmitButton()},allmoveToRightEmp:function(){this.resetErrorMessages(),this.rightTenants=this.rightTenants.concat(this.leftTenants.filter((function(e){return null!=e.profile_picture}))),this.leftTenants=this.leftTenants.filter((function(e){return null==e.profile_picture})),this.rightTenants=this.sortObject(this.rightTenants),this.verifySubmitButton()},moveToLeftempOption2:function(){var e=this;if(this.resetErrorMessages(),this.rightSelectedEmp.length){for(var t=this.rightSelectedEmp.length,n=function(i){if(e.rightSelectedEmp){var t=e.rightTenants.findIndex((function(t){return t.id==e.rightSelectedEmp[i]})),n=e.rightTenants.find((function(t){return t.id==e.rightSelectedEmp[i]}));n.sdkEmpResponse="",e.leftTenants.push(n),e.rightTenants.splice(t,1)}},i=0;i<t;i++)n(i);this.leftTenants=this.sortObject(this.leftTenants);for(var r=0;r<t;r++)this.rightSelectedEmp.pop(this.rightSelectedEmp[r]);this.verifySubmitButton()}},moveToLeftemp:function(e){var t=this;if(this.resetErrorMessages(),this.rightSelectedEmp.push(e),this.rightSelectedEmp.length){for(var n=this.rightSelectedEmp.length,r=function(i){if(t.rightSelectedEmp){var e=t.rightTenants.findIndex((function(e){return e.id==t.rightSelectedEmp[i]})),n=t.rightTenants.find((function(e){return e.id==t.rightSelectedEmp[i]}));n.sdkEmpResponse="",t.leftTenants.push(n),t.rightTenants.splice(e,1)}},i=0;i<n;i++)r(i);this.leftTenants=this.sortObject(this.leftTenants),this.rightSelectedEmp.pop(e),this.verifySubmitButton()}},selectLeftTenant:function(e){this.leftSelectedEmp.push(e)},moveToRightEmpOption2:function(){var e=this;if(this.resetErrorMessages(),this.leftSelectedEmp.length){for(var t=this.leftSelectedEmp.length,n=function(i){if(e.leftSelectedEmp){var t=e.leftTenants.findIndex((function(t){return t.id==e.leftSelectedEmp[i]})),n=e.leftTenants.find((function(t){return t.id==e.leftSelectedEmp[i]}));e.rightTenants.push(n),e.leftTenants.splice(t,1)}},i=0;i<t;i++)n(i);this.rightTenants=this.sortObject(this.rightTenants);for(var r=0;r<t;r++)this.leftSelectedEmp.pop(this.leftSelectedEmp[r]);this.verifySubmitButton()}},allmoveToLeftDevices:function(){this.resetErrorMessages(),this.leftDevices=this.leftDevices.concat(this.rightDevices),this.rightDevices=[],this.leftDevices=this.sortObjectD(this.leftDevices),this.verifySubmitButton()},allmoveToRightDevices:function(){this.resetErrorMessages(),this.rightDevices=this.rightDevices.concat(this.leftDevices.filter((function(e){return"active"==e.status.name}))),this.leftDevices=this.leftDevices.filter((function(e){return"inactive"==e.status.name})),this.rightDevices=this.sortObjectD(this.rightDevices),this.verifySubmitButton()},moveToLeftDevicesOption2:function(){var e=this;if(this.resetErrorMessages(),this.rightSelectedDevices.length){for(var t=this.rightSelectedDevices.length,n=function(i){if(e.rightSelectedDevices){var t=e.rightDevices.findIndex((function(t){return t.id==e.rightSelectedDevices[i]})),n=e.rightDevices.find((function(t){return t.id==e.rightSelectedDevices[i]}));n.sdkEmpResponse="",e.leftDevices.push(n),e.rightDevices.splice(t,1)}},i=0;i<t;i++)n(i);this.leftDevices=this.sortObjectD(this.leftDevices);for(var r=0;r<t;r++)this.rightSelectedDevices.pop(this.rightSelectedDevices[r]);this.verifySubmitButton()}},moveToLeftDevices:function(e){var t=this;if(this.resetErrorMessages(),this.rightSelectedDevices.push(e),this.rightSelectedDevices.length){for(var n=this.rightSelectedDevices.length,r=function(i){if(t.rightSelectedDevices){var e=t.rightDevices.findIndex((function(e){return e.id==t.rightSelectedDevices[i]})),n=t.rightDevices.find((function(e){return e.id==t.rightSelectedDevices[i]}));t.leftDevices.push(n),t.rightDevices.splice(e,1)}},i=0;i<n;i++)r(i);this.leftDevices=this.sortObjectD(this.leftDevices),this.rightSelectedDevices.pop(e),this.verifySubmitButton()}},moveToRightDevicesOption2:function(){var e=this;if(this.resetErrorMessages(),this.leftSelectedDevices.length){for(var t=this.leftSelectedDevices.length,n=function(i){if(e.leftSelectedDevices){var t=e.leftDevices.findIndex((function(t){return t.id==e.leftSelectedDevices[i]})),n=e.leftDevices.find((function(t){return t.id==e.leftSelectedDevices[i]}));n.sdkDeviceResponse="",e.rightDevices.push(n),e.leftDevices.splice(t,1)}},i=0;i<t;i++)n(i);this.rightDevices=this.sortObjectD(this.rightDevices);for(var r=0;r<t;r++)this.leftSelectedDevices.pop(this.leftSelectedDevices[r]);this.verifySubmitButton()}},moveToRightDevices:function(e){var t=this;if(this.resetErrorMessages(),this.leftSelectedDevices.push(e),this.leftSelectedDevices.length){for(var n=this.leftSelectedDevices.length,r=function(i){if(t.leftSelectedDevices){var e=t.leftDevices.findIndex((function(e){return e.id==t.leftSelectedDevices[i]})),n=t.leftDevices.find((function(e){return e.id==t.leftSelectedDevices[i]}));n.sdkDeviceResponse="",t.rightDevices.push(n),t.leftDevices.splice(e,1)}},i=0;i<n;i++)r(i);this.rightDevices=this.sortObjectD(this.rightDevices),this.leftSelectedDevices.pop(e),this.verifySubmitButton()}},processPayload:function(){var e=this;return Object(D.a)(regeneratorRuntime.mark((function t(){var n,r,o,c,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={company_id:e.$auth.user.company_id,floor_id:e.floor_id,room_id:e.room_id,timezone_id:e.timezone_id,device_ids:e.rightDevices.map((function(e){return e.device_id})),tanents:e.rightTenants.map((function(e){return{id:e.id,full_name:e.full_name,system_user_id:e.system_user_id}}))},0==e.rightTenants.length?e.response=e.response+" Atleast select one Tenant Details":0==e.rightDevices.length&&(e.response=e.response+" Atleast select one Device Details"),e.loading=!0,e.loading_dialog=!0,e.errors=[],t.prev=5,t.next=8,e.$axios.post("/tanent-timezone-mapping",n);case 8:return t.next=10,e.uploadToDevices();case 10:t.next=25;break;case 12:if(t.prev=12,t.t0=t.catch(5),r=t.t0.response,e.loading_dialog=!1,e.loading=!1,e.displaybutton=!0,r){t.next=20;break}return t.abrupt("return");case 20:if(o=r.status,c=r.statusText,data=r.data,422!=o){t.next=24;break}return e.errors=data.errors,t.abrupt("return");case 24:console.log(c);case 25:case"end":return t.stop()}}),t,null,[[5,12]])})))()},uploadToDevices:function(){var e=this;return Object(D.a)(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.rightTenants.map((function(t){return{name:t.full_name,userCode:parseInt(t.system_user_id),faceImage:t.profile_picture,cardData:t.rfid,timeGroup:e.timezone_id}})),r=e.rightDevices.map((function(e){return e.device_id})),!(o={personList:n,snList:r}).snList||0!==o.snList.length){t.next=6;break}return alert("Atleast one device must be selected"),t.abrupt("return",!1);case 6:return e.devices_dialog.forEach((function(e){e.state="---",e.message="---"})),t.next=9,e.$axios.post("/Person/AddRange/Photos",o);case 9:console.log(o);try{e.snackbar.show=!0,e.response="Tanents(s) Pictures has been uploaded",e.loading_dialog=!1,e.loading=!1,e.displaybutton=!0,e.errors=[],setTimeout((function(){return e.goback()}),3e3)}catch(t){e.loading_dialog=!1,e.loading=!1,e.displaybutton=!0,e.errors=[]}case 11:case"end":return t.stop()}}),t)})))()}}}),y=n(116),component=Object(y.a)(T,(function(){var e=this,t=e._self._c;return t(h.a,{attrs:{persistent:"",width:"500"},scopedSlots:e._u([{key:"activator",fn:function(n){var r=n.on,o=n.attrs;return[t("span",e._g(e._b({staticStyle:{cursor:"pointer"}},"span",o,!1),r),[t(f.a,{attrs:{color:"error",small:""}},[e._v(" mdi-delete ")]),e._v("\n      Delete\n    ")],1)]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[e._v(" "),t(r.a,[t(o.c,[e._v("\n      Delete Mapping "),t(v.a),e._v(" "),t(f.a,{attrs:{color:"primary"},on:{click:function(t){e.dialog=!1}}},[e._v("mdi-close")])],1),e._v(" "),t(l.a,{attrs:{fluid:""}},[t("div",{staticClass:"text-center ma-2"},[t(m.a,{attrs:{color:"primary",small:"",top:"top",timeout:3e3},model:{value:e.snackbar.show,callback:function(t){e.$set(e.snackbar,"show",t)},expression:"snackbar.show"}},[e._v("\n          Users has been uploaded.\n        ")])],1),e._v(" "),e.can("tanent_access")?t("div",{staticStyle:{width:"100% !important"}},e._l(e.item.mappings,(function(n,o){return t(r.a,{key:o,staticClass:"mb-2",attrs:{outlined:""}},[t(l.a,[t(d.a,{staticClass:"mt-1"},[t(c.a,{attrs:{cols:"10"}},[t(_.a,{staticClass:"text-center",attrs:{readonly:"",label:"Timezone",dense:"",outlined:"","hide-details":""},model:{value:n.timezone.timezone_name,callback:function(t){e.$set(n.timezone,"timezone_name",t)},expression:"mapping.timezone.timezone_name"}})],1),e._v(" "),t(c.a,{staticClass:"text-right"},[t(f.a,{attrs:{color:"error"},on:{click:function(t){return e.deleteMapping(n.id)}}},[e._v("mdi-delete")])],1)],1)],1)],1)})),1):t("NoAccess")],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{NoAccess:n(881).default})},881:function(e,t,n){"use strict";n.r(t);var r=n(116),component=Object(r.a)({},(function(){this._self._c;return this._m(0)}),[function(){var e=this._self._c;return e("div",{staticClass:"text-center",staticStyle:{"margin-top":"25%"}},[e("b",[this._v("No Access")])])}],!1,null,null,null);t.default=component.exports}}]);